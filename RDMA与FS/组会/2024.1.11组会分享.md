要搞懂**RDMA**优势何在，我们可以从最基本的网络传输工作说起。在传统的网络传输中，用户程序通常需要调用两个系统调用：
```cpp
read(file, tmp_buf, len);
write(socket, tmp_buf, len);
```

对应的流程图如下：
![[Pasted image 20240110113854.png]]
可以看到整个过程经历了4次上下文切换、4次数据拷贝。其中CPU需要直接参与到在内核空间中通过TCP/IP软件栈对数据进行封装，并将数据在内核空间和用户空间之间来回拷贝，非常花时间。

为了将CPU从I/O工作中解放出来，我们可以尝试绕过内核，直接将磁盘文件送入网卡中，交由网卡进行传输前的各种处理，这就引出了**RDMA**。

![[Pasted image 20240110161614.png]]
相同的网络传输场景下，RDMA的流程图如上，对于发送方而言，操作如下：
1. 用户程序向网卡传递任务
2. 网卡通过任务描述从内存中直接取得需要传输的数据，通过硬件进行报文的封装，随后发出

整个过程不需要经过CPU，也就不存在上下文的切换，同时数据只通过DMA拷贝了一次，报文的封装也由网卡中的硬件完成，大大压缩了时间。



