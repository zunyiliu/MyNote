# 概述
![[Pasted image 20230912195523.png]]
由上图可知，整个物理内存在装载内核时就已经被占据大部分，因而留给可用物理内存分配的区域就是内核的尾部-PHYSTOP，我们将在这一块区域划分成多个page用于分配。

# kinit
该函数代码如下，实际上就是包含两个工作：
1. 初始化物理内存分配器的锁
2. 调用`freerange`，将物理地址`end`至`PHYSTOP`区域的物理内存划分成多个page，并放入物理内存分配器中
![[Pasted image 20240119153754.png]]

# freerange
![[Pasted image 20240119153947.png]]
该函数工作如下：
- 遍历物理地址`pa_start`至`pa_end`区域，将其中的物理内存划分为多个page，然后调用`kfree`，将其放入物理内存分配器中

# kfree
该函数就是将传入的物理地址对应的页清空内容，然后放入物理内存分配器中。实际上的物理内存分配器就是一个链表，将所有可用page串联在一起。
![[Pasted image 20240119154236.png]]

# kalloc
该函数就是从物理内存分配器的链表中取出一个page，然后进行返回即可。
![[Pasted image 20240119154413.png]]

